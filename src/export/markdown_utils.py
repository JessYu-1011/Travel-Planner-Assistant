def create_itinerary_markdown(trip_data):
    """
    å°‡è¡Œç¨‹è³‡æ–™è½‰æ›ç‚º Markdown æ ¼å¼å­—ä¸²
    """
    lines = []
    
    # 1. æ¨™é¡Œ
    trip_name = trip_data.get('trip_name', 'æ—…éŠè¡Œç¨‹è¡¨')
    lines.append(f"# âœˆï¸ {trip_name}")
    lines.append("") # ç©ºè¡Œ
    
    # 2. æ©Ÿç¥¨è³‡è¨Š
    flight = trip_data.get('flight')
    if flight:
        lines.append("## ğŸ›« èˆªç­è³‡è¨Š")
        airline = flight.get('airline') or "æœªå®š"
        price = flight.get('price') or "æœªå®š"
        link = flight.get('link') or "#"
        
        lines.append(f"- **èˆªç©ºå…¬å¸**: {airline}")
        lines.append(f"- **åƒè€ƒåƒ¹æ ¼**: {price}")
        lines.append(f"- [å‰å¾€è¨‚ç¥¨]({link})")
        lines.append("")

    # 3. æ¯æ—¥è¡Œç¨‹ (ä½¿ç”¨è¡¨æ ¼å‘ˆç¾)
    itinerary = trip_data.get('daily_itinerary', [])
    if itinerary:
        lines.append("## ğŸ“… æ¯æ—¥è¡Œç¨‹è©³ç´°")
        lines.append("")
        
        for day in itinerary:
            day_num = day.get('day', '?')
            theme = day.get('theme', 'ç²¾å½©è¡Œç¨‹')
            
            lines.append(f"### Day {day_num}: {theme}")
            
            # Markdown è¡¨æ ¼ Header
            lines.append("| æ™‚é–“ | æ™¯é» | èªªæ˜ |")
            lines.append("| :--- | :--- | :--- |")
            
            for spot in day.get('attractions', []):
                time = spot.get('time', '')
                name = spot.get('name', '')
                # æ¸…ç†æ›è¡Œç¬¦è™Ÿèˆ‡ | ç¬¦è™Ÿï¼Œé¿å…ç ´å£ Markdown è¡¨æ ¼çµæ§‹
                desc = spot.get('description', '').replace('\n', ' ').replace('|', '\|')
                
                lines.append(f"| **{time}** | {name} | {desc} |")
            
            lines.append("") # æ¯å¤©çµæŸå¾ŒåŠ å€‹ç©ºè¡Œ

    # 4. ç¥¨åˆ¸æ¯”åƒ¹æ¸…å–®
    activities = trip_data.get('activities', [])
    if activities:
        lines.append("## ğŸ« æ¨è–¦ç¥¨åˆ¸ (AI æ¯”åƒ¹)")
        for act in activities:
            platform = act.get('platform', 'OTA').upper()
            title = act.get('title') or act.get('name') or 'ç¥¨åˆ¸'
            price = act.get('price', 'æŸ¥çœ‹å„ªæƒ ')
            link = act.get('link') or act.get('ticket_link') or '#'
            
            lines.append(f"- **[{platform}]** {title} - *{price}* -> [é€£çµ]({link})")
    
    lines.append("")
    lines.append("---")
    lines.append("*Generated by AI Travel Planner*")
    
    # å°‡ List è½‰ç‚ºå–®ä¸€å­—ä¸²
    return "\n".join(lines)